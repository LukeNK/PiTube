<!DOCTYPE html>
<html>
<head>
    <title>PiTube</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav>
        <h1>PiTube</h1>
    </nav>
    <main>
        <div id="player">
            <video id="playerVid" controls></video>
            <div id="controls">
                <!-- <button onclick="document.getElementById('playerVid').currentTime += 5">-5s</button>
                <button onclick="document.getElementById('playerVid').currentTime += 5">+5s</button> -->
            </div>
        </div>
        <div id="browse"></div>
    </main>
</body>
<script>
    // check url expiration date
    function expireCheck(url) {
        url = new URL(url)
        if (url.searchParams.get('expire') > new Date() / 1000)
            return true
        return false
    }

    fetch('/database').then(res => res.json())
    .then(res => {
        let browse = document.getElementById('browse');
        for (const id of Object.keys(res)) {
            // client check links to reduce server load
            if (!expireCheck(res[id].url))
                return fetch('/expire#' + id);

            let div = document.createElement('div'),
                h = document.createElement('h3');

            div.innerHTML = `<img src="${res[id].thumbnail_url}">`;
            div.addEventListener('click', ev => {
                document.getElementById('player').style.display = 'block';
                document.getElementById('playerVid').setAttribute(
                    'src',
                    res[id].url
                )
            })

            h.innerText = res[id].title

            div.append(h);
            if (id == location.hash.slice(1))
                div.click()

            browse.prepend(div);
        }
    });
</script>
</html>